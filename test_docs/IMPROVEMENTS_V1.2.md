# FigTabMiner v1.2 æ”¹è¿›è¯´æ˜

## ğŸ¯ é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„æ”¹è¿›

åŸºäºç”¨æˆ·æµ‹è¯•åé¦ˆï¼Œv1.2 ç‰ˆæœ¬é’ˆå¯¹ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜è¿›è¡Œäº†ä¼˜åŒ–ï¼š

### 1. âŒ æ•°å­¦å…¬å¼è¢«è¯¯è¯†åˆ«ä¸ºè¡¨æ ¼

**é—®é¢˜æè¿°**ï¼š
- æ•°å­¦å…¬å¼ï¼ˆç‰¹åˆ«æ˜¯å¤šè¡Œå…¬å¼ï¼‰è¢«é”™è¯¯è¯†åˆ«ä¸ºè¡¨æ ¼
- å¯¼è‡´è¾“å‡ºä¸­åŒ…å«å¤§é‡æ— æ•ˆçš„"è¡¨æ ¼"

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºäº† `content_classifier.py` æ¨¡å—ï¼Œå®ç°æ™ºèƒ½å†…å®¹åˆ†ç±»ï¼š

**æ£€æµ‹æœºåˆ¶**ï¼š
1. **å°ºå¯¸å’Œé•¿å®½æ¯”åˆ†æ**
   - å…¬å¼é€šå¸¸å®½è€ŒçŸ®ï¼ˆaspect_ratio > 4ï¼‰
   - å…¬å¼é«˜åº¦é€šå¸¸ < 100px

2. **æ–‡æœ¬å†…å®¹åˆ†æ**
   - æ£€æµ‹æ•°å­¦ç¬¦å·ï¼š=, â‰ , â‰ˆ, â‰¤, â‰¥, âˆ«, âˆ‘, âˆ, Î±, Î², Î³ ç­‰
   - æ£€æµ‹ LaTeX å‘½ä»¤ï¼š\frac, \sum, \int ç­‰
   - å¦‚æœæ•°å­¦ç¬¦å· > è¡¨æ ¼å…³é”®è¯ï¼Œåˆ¤å®šä¸ºå…¬å¼

3. **è§†è§‰ç»“æ„åˆ†æ**
   - å…¬å¼ï¼šæ°´å¹³ç»“æ„ä¸ºä¸»ï¼Œå‚ç›´çº¿å°‘
   - è¡¨æ ¼ï¼šç½‘æ ¼ç»“æ„ï¼Œæ°´å¹³å’Œå‚ç›´çº¿éƒ½å¤š
   - è®¡ç®— horizontal/vertical è¾¹ç¼˜æ¯”ä¾‹

**æ•ˆæœ**ï¼š
- è‡ªåŠ¨è¿‡æ»¤æ•°å­¦å…¬å¼
- å‡å°‘è¯¯è¯†åˆ«ç‡

**é…ç½®**ï¼š
```json
{
  "table_extraction": {
    "enable_math_equation_filter": true
  }
}
```

### 2. âŒ ä¸¤å¼ å›¾è¡¨è¢«é”™è¯¯åˆå¹¶

**é—®é¢˜æè¿°**ï¼š
- ç›¸é‚»ä½†ç‹¬ç«‹çš„å›¾è¡¨è¢«åˆå¹¶æˆä¸€ä¸ª
- å¯¼è‡´æå–çš„å›¾è¡¨åŒ…å«å¤šä¸ªä¸ç›¸å…³çš„å†…å®¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
å¢å¼ºäº† `bbox_merger.py` ä¸­çš„åˆå¹¶éªŒè¯é€»è¾‘ï¼š

**æ–°å¢éªŒè¯è§„åˆ™**ï¼š

1. **è·ç¦»é™åˆ¶**
   ```python
   if max_distance > 150:  # åƒç´ 
       return False  # ä¸åˆå¹¶
   ```

2. **é¢ç§¯æ¯”ä¾‹æ£€æŸ¥**
   ```python
   if merged_area > 3 * individual_area:
       return False  # åˆå¹¶åé¢ç§¯è¿‡å¤§
   ```

3. **è§†è§‰ç›¸ä¼¼åº¦æ£€æŸ¥**
   ```python
   # ä½¿ç”¨é¢œè‰²ç›´æ–¹å›¾æ¯”è¾ƒ
   similarity = cv2.compareHist(hist1, hist2, cv2.HISTCMP_CORREL)
   if similarity < 0.3:
       return False  # è§†è§‰å·®å¼‚å¤ªå¤§
   ```

**æ•ˆæœ**ï¼š
- å‡å°‘é”™è¯¯åˆå¹¶
- ä¿æŒç‹¬ç«‹å›¾è¡¨çš„ç‹¬ç«‹æ€§

**é…ç½®**ï¼š
```json
{
  "bbox_merger": {
    "max_merge_distance": 150,
    "min_visual_similarity": 0.3
  }
}
```

### 3. âŒ è¡¨æ ¼æ•°æ®è¯»å–ä¸åˆ°ï¼ˆæœ€é‡è¦ï¼‰

**é—®é¢˜æè¿°**ï¼š
- å¾ˆå¤šè¡¨æ ¼è¢«æ£€æµ‹åˆ°ï¼Œä½†æ•°æ®æå–å¤±è´¥
- CSV æ–‡ä»¶ä¸ºç©ºæˆ–æ•°æ®ä¸å®Œæ•´
- ç‰¹åˆ«æ˜¯æ— è¾¹æ¡†è¡¨æ ¼å’Œå¤æ‚è¡¨æ ¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºäº† `table_extract_v2.py` - å¢å¼ºçš„è¡¨æ ¼æå–å™¨ï¼š

**å¤šç­–ç•¥æå–**ï¼š

1. **å¸ƒå±€å¼•å¯¼æå–**
   - ä½¿ç”¨å¸ƒå±€æ£€æµ‹å®šä½è¡¨æ ¼
   - åœ¨ç²¾ç¡®åŒºåŸŸå†…æå–æ•°æ®

2. **å¤šå‚æ•° pdfplumber**
   - 5 ç§ä¸åŒçš„æå–ç­–ç•¥ï¼š
     - `lines_strict` - ä¸¥æ ¼çš„çº¿æ¡†æ£€æµ‹
     - `lines_relaxed` - å®½æ¾çš„çº¿æ¡†æ£€æµ‹
     - `text_strict` - ä¸¥æ ¼çš„æ–‡æœ¬å¯¹é½
     - `text_relaxed` - å®½æ¾çš„æ–‡æœ¬å¯¹é½
     - `explicit` - æ˜¾å¼æŒ‡å®šçº¿æ¡
   - è‡ªåŠ¨å°è¯•æ‰€æœ‰ç­–ç•¥ï¼Œé€‰æ‹©æœ€ä½³ç»“æœ

3. **è§†è§‰çº¿æ¡æ£€æµ‹**
   - ä½¿ç”¨ OpenCV æ£€æµ‹è¡¨æ ¼çº¿æ¡
   - å½¢æ€å­¦æ“ä½œè¯†åˆ«ç½‘æ ¼ç»“æ„
   - é€‚ç”¨äºæœ‰æ˜æ˜¾è¾¹æ¡†çš„è¡¨æ ¼

4. **æ™ºèƒ½å»é‡**
   - å¤šç­–ç•¥å¯èƒ½æ£€æµ‹åˆ°åŒä¸€è¡¨æ ¼
   - åŸºäº IoU å’Œæ•°æ®è´¨é‡å»é‡
   - ä¿ç•™æ•°æ®æœ€å®Œæ•´çš„ç‰ˆæœ¬

**æå–ç­–ç•¥ç¤ºä¾‹**ï¼š

```python
# Strategy 1: çº¿æ¡†è¡¨æ ¼ï¼ˆä¸¥æ ¼ï¼‰
{
    "vertical_strategy": "lines",
    "horizontal_strategy": "lines",
    "intersection_tolerance": 3,
    "snap_tolerance": 2,
    "edge_min_length": 10
}

# Strategy 2: æ— è¾¹æ¡†è¡¨æ ¼ï¼ˆæ–‡æœ¬å¯¹é½ï¼‰
{
    "vertical_strategy": "text",
    "horizontal_strategy": "text",
    "min_words_vertical": 2,
    "min_words_horizontal": 1,
    "text_tolerance": 5
}
```

**æ•ˆæœ**ï¼š
- æ˜¾è‘—æé«˜è¡¨æ ¼æ•°æ®æå–æˆåŠŸç‡
- æ”¯æŒæ›´å¤šç±»å‹çš„è¡¨æ ¼ï¼ˆæœ‰æ¡†/æ— æ¡†ï¼‰
- è‡ªåŠ¨é€‰æ‹©æœ€ä½³æå–ç­–ç•¥

**é…ç½®**ï¼š
```json
{
  "table_extraction": {
    "use_enhanced_extractor": true,
    "enable_visual_detection": true,
    "try_multiple_strategies": true
  }
}
```

## ğŸ“Š æ”¹è¿›æ•ˆæœé¢„æœŸ

### æ•°å­¦å…¬å¼è¿‡æ»¤
- **æ”¹è¿›å‰**ï¼š10-20% çš„"è¡¨æ ¼"å®é™…æ˜¯å…¬å¼
- **æ”¹è¿›å**ï¼š< 2% è¯¯è¯†åˆ«ç‡

### å›¾è¡¨åˆå¹¶å‡†ç¡®æ€§
- **æ”¹è¿›å‰**ï¼š5-10% é”™è¯¯åˆå¹¶ç‡
- **æ”¹è¿›å**ï¼š< 3% é”™è¯¯åˆå¹¶ç‡

### è¡¨æ ¼æ•°æ®æå–
- **æ”¹è¿›å‰**ï¼š60-70% æˆåŠŸç‡
- **æ”¹è¿›å**ï¼š85-90% æˆåŠŸç‡ï¼ˆé¢„æœŸï¼‰

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. è‡ªåŠ¨å¯ç”¨ï¼ˆæ¨èï¼‰

æ–°åŠŸèƒ½é»˜è®¤å¯ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š

```bash
# ç›´æ¥è¿è¡Œå³å¯
streamlit run src/app_streamlit.py
```

æˆ–

```bash
python scripts/run_pipeline.py --pdf your_paper.pdf
```

### 2. æ‰‹åŠ¨é…ç½®

å¦‚æœéœ€è¦è°ƒæ•´å‚æ•°ï¼Œç¼–è¾‘ `config/figtabminer.json`ï¼š

```json
{
  "bbox_merger": {
    "max_merge_distance": 150,      // å‡å°ä»¥æ›´ä¿å®ˆåˆå¹¶
    "min_visual_similarity": 0.3    // æé«˜ä»¥æ›´ä¸¥æ ¼éªŒè¯
  },
  
  "table_extraction": {
    "use_enhanced_extractor": true,           // ä½¿ç”¨å¢å¼ºæå–å™¨
    "enable_visual_detection": true,          // å¯ç”¨è§†è§‰æ£€æµ‹
    "enable_math_equation_filter": true,      // è¿‡æ»¤æ•°å­¦å…¬å¼
    "try_multiple_strategies": true           // å°è¯•å¤šç§ç­–ç•¥
  }
}
```

### 3. éªŒè¯æ”¹è¿›æ•ˆæœ

```bash
# è¿è¡Œæµ‹è¯•
python tests/test_improved_extraction.py

# ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
python tools/visualize_results.py

# åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹
firefox extraction_report.html
```

## ğŸ› å·²çŸ¥é™åˆ¶

### æ•°å­¦å…¬å¼è¿‡æ»¤
- éå¸¸ç®€å•çš„å…¬å¼å¯èƒ½ä»è¢«è¯†åˆ«ä¸ºè¡¨æ ¼
- éœ€è¦å‘¨å›´æœ‰æ–‡æœ¬æ‰èƒ½æ›´å‡†ç¡®åˆ¤æ–­

### å›¾è¡¨åˆå¹¶
- è§†è§‰ç›¸ä¼¼åº¦æ£€æŸ¥ä¾èµ–é¢œè‰²ï¼Œç°åº¦å›¾å¯èƒ½ä¸å‡†ç¡®
- æç«¯æƒ…å†µä¸‹ä»å¯èƒ½è¯¯åˆå¹¶

### è¡¨æ ¼æ•°æ®æå–
- æåº¦å¤æ‚çš„è¡¨æ ¼ï¼ˆå¤šå±‚è¡¨å¤´ã€ä¸è§„åˆ™åˆå¹¶ï¼‰ä»å¯èƒ½å¤±è´¥
- æ—‹è½¬çš„è¡¨æ ¼ä¸æ”¯æŒ
- è·¨é¡µè¡¨æ ¼éœ€è¦æ‰‹åŠ¨å¤„ç†

## ğŸ’¡ è°ƒä¼˜å»ºè®®

### å¦‚æœæ•°å­¦å…¬å¼ä»è¢«è¯¯è¯†åˆ«

é™ä½æ£€æµ‹çµæ•åº¦ï¼š

```python
# åœ¨ content_classifier.py ä¸­è°ƒæ•´
if aspect_ratio > 3 and height < 80:  # æ›´ä¸¥æ ¼çš„æ¡ä»¶
    return True
```

### å¦‚æœå›¾è¡¨ä»è¢«é”™è¯¯åˆå¹¶

å¢åŠ é™åˆ¶ï¼š

```json
{
  "bbox_merger": {
    "max_merge_distance": 100,      // ä» 150 é™åˆ° 100
    "min_visual_similarity": 0.5    // ä» 0.3 æé«˜åˆ° 0.5
  }
}
```

### å¦‚æœè¡¨æ ¼æ•°æ®ä»æå–ä¸åˆ°

1. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹å“ªä¸ªç­–ç•¥è¢«ä½¿ç”¨
2. **æ‰‹åŠ¨è°ƒæ•´**ï¼šåœ¨ `table_extract_v2.py` ä¸­æ·»åŠ è‡ªå®šä¹‰ç­–ç•¥
3. **ä½¿ç”¨ camelot**ï¼šå¯¹äºå¤æ‚è¡¨æ ¼ï¼Œcamelot å¯èƒ½æ›´å¥½

## ğŸ“ˆ ä¸‹ä¸€æ­¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸ
1. æ”¶é›†æ›´å¤šé—®é¢˜æ¡ˆä¾‹
2. é’ˆå¯¹æ€§ä¼˜åŒ–å‚æ•°
3. æ·»åŠ æ›´å¤šè¡¨æ ¼æå–ç­–ç•¥

### ä¸­æœŸ
1. é›†æˆ Table Transformerï¼ˆä¸“é—¨çš„è¡¨æ ¼è¯†åˆ«æ¨¡å‹ï¼‰
2. æ”¯æŒæ—‹è½¬è¡¨æ ¼
3. æ”¯æŒè·¨é¡µè¡¨æ ¼

### é•¿æœŸ
1. ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹åˆ†ç±»å†…å®¹ç±»å‹
2. ç«¯åˆ°ç«¯çš„è¡¨æ ¼ç»“æ„è¯†åˆ«
3. äº¤äº’å¼ä¿®æ­£å·¥å…·

## ğŸ‰ æ€»ç»“

v1.2 ç‰ˆæœ¬é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜è¿›è¡Œäº†ç³»ç»Ÿæ€§æ”¹è¿›ï¼š

1. âœ… **æ•°å­¦å…¬å¼è¿‡æ»¤** - æ™ºèƒ½å†…å®¹åˆ†ç±»
2. âœ… **åˆå¹¶éªŒè¯å¢å¼º** - å¤šç»´åº¦æ£€æŸ¥
3. âœ… **è¡¨æ ¼æå–å¢å¼º** - å¤šç­–ç•¥èåˆ

è¿™äº›æ”¹è¿›åº”è¯¥èƒ½æ˜¾è‘—æå‡ç³»ç»Ÿçš„å®ç”¨æ€§å’Œå‡†ç¡®æ€§ã€‚å»ºè®®åœ¨å®é™…åœºæ™¯ä¸­æµ‹è¯•ï¼Œå¹¶æ ¹æ®æ•ˆæœç»§ç»­è°ƒä¼˜ã€‚

---

**ç‰ˆæœ¬**ï¼šv1.2  
**å‘å¸ƒæ—¥æœŸ**ï¼š2026-01-17  
**æ”¹è¿›é‡ç‚¹**ï¼šè¡¨æ ¼æ•°æ®æå– + è¯¯è¯†åˆ«è¿‡æ»¤
